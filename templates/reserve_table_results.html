{% if reserves %}
{% for reserve in reserves %}
{% if highlighted and highlighted["reserve"] and highlighted["reserve"]==reserve.rsv_id %}
<tr class="highlighted-row">
  {% else %}
<tr>
  {% endif %}
  {% if current_user.role.rank == 'admin' %}
  <td>{{ reserve.rsv_id }}</td>
  {% endif %}
  <td>{{ users[reserve.owner] | capitalize }}</td>
  <td>{{ reserve.saleprice }}</td>
  <td>{{ reserve.rsv_date.strftime('%Y-%m-%d') }}</td>
  <td>{% if reserve.cfm_date %}{{ reserve.cfm_date.strftime('%Y-%m-%d') }}{% endif %}</td>
  <td>{{ users[reserve.cfm_cs] | capitalize }}</td>
  <td>{{ reserve.void_yesno() }}</td>
  <td>{{ reserve.remark }}</td>
  <td>
    <div class="d-flex justify-content-end gap-2">
      {% if current_user.role.rank == 'admin' or (current_user.role.rank == 'cs' and current_user.id == result.owner) %}
        {% if not reserve.void %}
          {% if reserve.space.spcstatus == 'RV_SUBMIT' %}
            <form action="{{ url_for('reserve.reserve_confirm', rsv_id=reserve.rsv_id) }}" method="POST" class="d-inline">
              <button data-bs-toggle="tooltip" data-bs-title="Confirm reserve" type="submit" class="btn btn-success"
                title="Confirm">
                <i class="bi bi-check-circle"></i>
              </button>
            </form>
          
          <form action="{{ url_for('reserve.reserve_decline', rsv_id=reserve.rsv_id) }}" method="POST" class="d-inline">
            <button data-bs-toggle="tooltip" data-bs-title="Decline reserve" type="submit" class="btn btn-danger"
              title="Decline">
              <i class="bi bi-x-circle"></i>
            </button>
          </form>
          {% endif %}

          <!-- If the reserve is confirmed, allow unconfirming -->
          {% if reserve.space.spcstatus == 'RV_CONFIRM' %}
            <form action="{{ url_for('reserve.reserve_unconfirm', rsv_id=reserve.rsv_id) }}" method="POST" class="d-inline">
              <button data-bs-toggle="tooltip" data-bs-title="Unconfirm reserve" type="submit" class="btn btn-warning"
                title="Unconfirm">
                <i class="bi bi-arrow-counterclockwise"></i>
              </button>
            </form>


            <div data-bs-toggle="tooltip" data-bs-title="Create booking">
              <a class="btn btn-primary"
                href="{{ url_for('booking.booking_add', spc_id=reserve.space.spc_id, rsv_id=reserve.rsv_id) }}">
                <i class="bi bi-plus-lg"></i>
              </a>
            </div>

          {% endif %}
        {% endif %}
      {% endif %}
      
      {% if (current_user.role.rank == 'sales' or current_user.role.rank == 'admin') and current_user.id == reserve.owner %}
        {% if reserve.space.spcstatus == 'RV_SUBMIT' and not reserve.cfm_cs and not reserve.void %}
        <form action="{{ url_for('reserve.reserve_cancel', rsv_id=reserve.rsv_id) }}" method="POST" class="d-inline">
          <button data-bs-toggle="tooltip" data-bs-title="Cancel reserve" type="submit" class="btn btn-secondary"
            onclick="return confirm('Are you sure you want to cancel this reserve?')" title="Cancel">
            <i class="bi bi-x-lg"></i>
          </button>
        </form>
        {% endif %}
      {% endif %}
      
      {% if current_user.role.rank == 'admin' or current_user.id == reserve.owner %}
      <div data-bs-toggle="tooltip" data-bs-title="Edit reserve">
        <a class="btn btn-warning" href="{{ url_for('reserve.reserve_edit', rsv_id=reserve.rsv_id) }}">
          <i class="bi bi-pencil-square"></i>
        </a>
      </div>
      {% endif %}
    </div>
  </td>
</tr>
{% endfor %}
{% else %}
<tr>
  <td colspan="14">You have not created any reserves. Reserve now -></td>
</tr>
{% endif %}