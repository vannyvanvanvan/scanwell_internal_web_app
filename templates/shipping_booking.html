{% extends 'base.html' %}
{% from '_render_input.html' import render_input_text, render_input_number, render_input_date, render_input_checkbox, render_input_select %}

{% block head %}
<title>{{ mode|capitalize }} Booking</title>
{% if mode == 'edit' %}
<script src="{{ url_for('static', filename='js/booking_void.js') }}" defer></script>
{% endif %}
{% endblock %}

{% block body %}

{% with title=mode|capitalize + " Booking" %}
{% include 'header.html' %}
{% endwith %}

<div class="mt-4">{% include 'flash.html' %}</div>

<section class="container p-4">

  <h3>Booking Details</h3>

  <form method="POST" class="mt-4">

    {{ render_input_text(name='SO', id='so', required=True, value=data.so) }}
    {{ render_input_text(name='Final Destination', id='findest', required=True, value=data.findest) }}
    {{ render_input_text(name='Container Class', id='ct_cl', required=True, value=data.ct_cl) }}
    {{ render_input_text(name='Shipper', id='shipper', required=True, value=data.shipper) }}
    {{ render_input_text(name='Consignee', id='consignee', required=True, value=data.consignee) }}
    {{ render_input_text(name='Term', id='term', required=True, value=data.term) }}

    {{ render_input_select(name='Sales', id='sales', required=True, value=data.sales, options=users_tuple_list ) }}

    {{ render_input_number(name='Sale Price', id='saleprice', required=True, value=data.saleprice) }}
    
    {% if mode == 'edit' and data.space.spcstatus == 'BK_CONFIRM' %}
        <!-- Show current space status and void option for confirmed bookings -->
        <div class="mb-3 row">
            <label for="current_space_status" class="col-sm-2 col-form-label">Current Space Status</label>
            <div class="col-sm-10">
                <input type="text" class="form-control status-disabled" id="current_space_status" value="BK_CONFIRM" disabled>
            </div>
        </div>
        
        {{ render_input_checkbox(name='Void', id='void', required=False, checked=data.void) }}
        
        <div id="void_space_status_div" style="display: none;" class="mb-3 row">
            <label for="void_space_status" class="col-sm-2 col-form-label">Space Status After Void</label>
            <div class="col-sm-10">
                <select class="form-select" id="void_space_status" name="void_space_status">
                    <option value="BK_CANCEL">BK_CANCEL - Space becomes invalid</option>
                    <option value="USABLE">USABLE - Space becomes available(within validity period)</option>
                </select>
            </div>
        </div>
    {% endif %}
    
    {{ render_input_text(name='Remark', id='remark', value=data.remark) }}

    <div class="d-inline-flex gap-2 mt-3">
      <a class="btn btn-danger" href="javascript:history.back()">Cancel</a>
      <input class="btn btn-primary" type="submit" value="Save Changes" />
    </div>

  </form>

</section>

{% endblock %}