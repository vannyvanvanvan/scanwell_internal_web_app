{% extends 'base.html' %}
{% from '_render_input.html' import render_input_text, render_input_number, render_input_date, render_input_checkbox,
render_input_select %}

{% block head %}
<title>{{ mode|capitalize }} Space</title>
<script src="{{ url_for('static', filename='js/space_rate_validation.js') }}" defer></script>
{% endblock %}

{% block body %}
{% with title=mode|capitalize + " Space" %}
{% include 'header.html' %}
{% endwith %}

<div class="mt-4">

  {% include 'flash.html' %}

</div>

<section class="container p-4">

  <h3>Space Details</h3>

  <form method="POST" class="mt-4">
    {{ render_input_text(name='Size', id='size', required=True, value=data.size) }}
    {{ render_input_number(name='Avgrate', id='avgrate', required=True, value=data.avgrate) }}
    {{ render_input_number(name='Sugrate', id='sugrate', required=True, value=data.sugrate) }}
    {{ render_input_date(name='Rate valid', id='ratevalid', required=True, value=data.ratevalid) }}
    {{ render_input_checkbox(name='Proport', id='proport', required=True, checked=data.proport) }}

    <!-- New spaces only allows USABLE or BK_RESERVED status -->
    {% if mode == 'add' %}

      {{ render_input_select(name='Space status', id='spcstatus', required=True, value=data.spcstatus,
      options=[('USABLE', 'USABLE'),
      ('BK_RESERVED', 'BK_RESERVED')
        ]
          )
            }}

    {% elif mode == 'edit' and is_status_readonly %}
      <!-- Read only statues when changed to RV_SUBMIT, RV_CONFIRM, BK_PENDING, BK_CONFIRM -->
      <div class="mb-3 row align-items-baseline">
        <label class="col-sm-2" for="spcstatus">Space status</label>
        <div class="col-sm-10">
          <select class="form-control status-disabled" id="spcstatus" name="spcstatus" disabled>
            {% set readonly_status_display = {
              'RV_SUBMIT': 'RV_SUBMIT',
              'RV_CONFIRM': 'RV_CONFIRM',
              'BK_PENDING': 'BK_PENDING',
              'BK_CONFIRM': 'BK_CONFIRM'
            } %}
            <option value="{{ data.spcstatus }}" selected>
              {{ readonly_status_display.get(data.spcstatus, data.spcstatus) }}
            </option>
          </select>
          <input type="hidden" name="spcstatus" value="{{ data.spcstatus }}">
        </div>
      </div>

    {% elif mode == 'edit' and is_new_space %}
      <!-- space editing only allows USABLE, BK_RESERVED, INVALID -->
      {{ render_input_select(name='Space status', id='spcstatus', required=True, value=data.spcstatus,
      options=[('USABLE', 'USABLE'),
      ('BK_RESERVED', 'BK_RESERVED'),
      ('INVALID', 'INVALID')
        ]
          )
            }}  

    {% else %}
      <!-- Regular space editing: all statuses available -->
      {{ render_input_select(name='Space status', id='spcstatus', required=True, value=data.spcstatus,
      options=[('USABLE', 'USABLE'),
      ('RV_SUBMIT', 'RV_SUBMIT'),
      ('RV_CONFIRM', 'RV_CONFIRM'),
      ('RV_CANCEL', 'RV_CANCEL'),
      ('BK_CONFIRM', 'BK_CONFIRM'),
      ('BK_RESERVED', 'BK_RESERVED'),
      ('BK_PENDING', 'BK_PENDING'),
      ('BK_CANCEL', 'BK_CANCEL'),
      ('INVALID', 'INVALID')
        ]
          )
            }}

    {% endif %}

    <div class="d-inline-flex gap-2 mt-3">
      <a class="btn btn-danger" href="javascript:history.back()">Cancel</a>
      <input class="btn btn-primary" type="submit" value="Save Changes" />
    </div>
  </form>
</section>
{% endblock %}